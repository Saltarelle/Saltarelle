<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
	<?include $(sys.CURRENTDIR)\Version.wxi ?>
	<Product Id="7341942A-29B9-45AA-BF92-E29139900E7D" Name="Saltarelle" Language="1033" Version="$(var.ProductVersion)" Manufacturer="Saltarelle" UpgradeCode="CB97D31F-A24E-4DCB-A2EF-803E60EDAAD5">
		<Package InstallerVersion="200" Compressed="yes" Id="*" />

		<Media Id="1" Cabinet="media1.cab" EmbedCab="yes" />

		<Directory Id="TARGETDIR" Name="SourceDir">
			<Component Id="NewtonsoftJsonComponentGAC" Guid="DBA2322E-EAE1-4F0E-A5BB-630FB7A04652">
				<File Id="NewtonsoftJsonDllGAC" Name="Newtonsoft.Json.dll" Assembly=".net" Source="..\packages\Newtonsoft.Json.4.0.7\lib\net35\Newtonsoft.Json.dll" KeyPath="yes" DiskId="1" />
			</Component>

			<Component Id="MonoCecilComponentGAC" Guid="5FF5A71F-5425-41DF-8CF9-B53A0FA5E30E">
				<File Id="MonoCecilDllGAC" Name="Mono.Cecil.dll" Assembly=".net" Source="..\packages\Mono.Cecil.0.9.5.2\lib\net35\Mono.Cecil.dll" KeyPath="yes" DiskId="1" />
			</Component>
			
			<Component Id="DotLessCssComponentGAC" Guid="3ED7991F-015E-4797-87A6-1F7BF19F6809">
				<File Id="DotLessCssDllGAC" Name="dotless.Core.dll" Assembly=".net" Source="..\packages\dotless.1.2.2.0\lib\dotless.Core.dll" KeyPath="yes" DiskId="1"/>
			</Component>

			<Component Id="LibComponentGAC" Guid="0834CF8C-2277-419B-AFD3-33129C0F6803">
				<File Id="LibDllGAC" Name="SaltarelleLib.dll" Assembly=".net" Source="..\SaltarelleLib\SaltarelleLib.Server\bin\SaltarelleLib.dll" KeyPath="yes" DiskId="1" />
			</Component>

			<Component Id="ParserComponentGAC" Guid="181B2420-DE35-486F-9987-0A2D0C80407F">
				<File Id="ParserDllGAC" Name="SaltarelleParser.dll" Assembly=".net" Source="..\SaltarelleParser\SaltarelleParser.Server\bin\SaltarelleParser.dll" KeyPath="yes" DiskId="1" />
			</Component>

			<Component Id="VSCustomToolComponentGAC" Guid="627A2006-9753-481E-9DA8-24FAE0781517">
				<File Id="VSCustomToolDllGAC" Name="Saltarelle.VSCustomTool.dll" Assembly=".net" Source="..\Executables\VSCustomTool\bin\Saltarelle.VSCustomTool.dll" KeyPath="yes" DiskId="1" />
				<Class Id="{D5BAD3F4-6C57-4901-AEEC-AE18BAB760D9}" Context="InprocServer32" Description="Saltarelle.SalgenCustomTool" ThreadingModel="both" ForeignServer="mscoree.dll">
					<ProgId Id="Saltarelle.SalgenCustomTool" Description="Saltarelle.SalgenCustomTool" />
				</Class>
				<RegistryValue Root="HKCR" Key="CLSID\{D5BAD3F4-6C57-4901-AEEC-AE18BAB760D9}\Implemented Categories\{62C8FE65-4EBB-45e7-B440-6E39B2CDBF29}" Value="" Type="string" Action="write" />
				<RegistryValue Root="HKCR" Key="CLSID\{D5BAD3F4-6C57-4901-AEEC-AE18BAB760D9}\InprocServer32\$(var.AssemblyVersion)" Name="Class" Value="Saltarelle.SalgenCustomTool" Type="string" Action="write" />
				<RegistryValue Root="HKCR" Key="CLSID\{D5BAD3F4-6C57-4901-AEEC-AE18BAB760D9}\InprocServer32\$(var.AssemblyVersion)" Name="Assembly" Value="Saltarelle.VSCustomTool, Version=$(var.AssemblyVersion), Culture=neutral, PublicKeyToken=346e0df1ad23b3c3" Type="string" Action="write" />
				<RegistryValue Root="HKCR" Key="CLSID\{D5BAD3F4-6C57-4901-AEEC-AE18BAB760D9}\InprocServer32\$(var.AssemblyVersion)" Name="RuntimeVersion" Value="v2.0.50727" Type="string" Action="write" />
				<RegistryValue Root="HKCR" Key="CLSID\{D5BAD3F4-6C57-4901-AEEC-AE18BAB760D9}\InprocServer32\$(var.AssemblyVersion)" Name="CodeBase" Value="file:///[#VSCustomToolDllGAC]" Type="string" Action="write" />
				<RegistryValue Root="HKCR" Key="CLSID\{D5BAD3F4-6C57-4901-AEEC-AE18BAB760D9}\InprocServer32" Name="Class" Value="Saltarelle.SalgenCustomTool" Type="string" Action="write" />
				<RegistryValue Root="HKCR" Key="CLSID\{D5BAD3F4-6C57-4901-AEEC-AE18BAB760D9}\InprocServer32" Name="Assembly" Value="Saltarelle.VSCustomTool, Version=$(var.AssemblyVersion), Culture=neutral, PublicKeyToken=346e0df1ad23b3c3" Type="string" Action="write" />
				<RegistryValue Root="HKCR" Key="CLSID\{D5BAD3F4-6C57-4901-AEEC-AE18BAB760D9}\InprocServer32" Name="RuntimeVersion" Value="v2.0.50727" Type="string" Action="write" />
				<RegistryValue Root="HKCR" Key="CLSID\{D5BAD3F4-6C57-4901-AEEC-AE18BAB760D9}\InprocServer32" Name="CodeBase" Value="file:///[#VSCustomToolDllGAC]" Type="string" Action="write" />
				<RegistryValue Root="HKCR" Key="Component Categories\{62C8FE65-4EBB-45e7-B440-6E39B2CDBF29}" Name="0" Value=".NET Category" Type="string" Action="write" />
			</Component>

			<Component Id="SalgenTaskComponentGAC" Guid="0EE6125B-CCD0-4EBC-8EAF-E52A278ACF6A">
				<File Id="SalgenTaskDllGAC" Name="Saltarelle.SalgenTask.dll" Assembly=".net" Source="..\Executables\SalgenTask\bin\Saltarelle.SalgenTask.dll" KeyPath="yes" DiskId="1" />
			</Component>

			<Directory Id="ProgramFilesFolder">
				<Directory Id="INSTALLLOCATION" Name="Saltarelle">
					<Component Id="NewtonsoftJsonComponent" Guid="DCB5798F-BE21-45c9-B81A-5637555D6AD1">
						<File Id="NewtonsoftJsonDll" Name="Newtonsoft.Json.dll" Source="..\packages\Newtonsoft.Json.4.0.7\lib\net35\Newtonsoft.Json.dll" KeyPath="yes" DiskId="1" />
					</Component>

					<Component Id="MonoCecilComponent" Guid="A8CC004F-1D80-48F6-A918-22BB922838B8">
						<File Id="MonoCecilDll" Name="Mono.Cecil.dll" Source="..\packages\Mono.Cecil.0.9.5.2\lib\net35\Mono.Cecil.dll" KeyPath="yes" DiskId="1" />
					</Component>

					<Component Id="DotLessCssComponent" Guid="4C976441-0EFB-446D-876E-A2AF8F80E3E7">
						<File Id="DotLessCssDll" Name="dotless.Core.dll" Source="..\packages\dotless.1.2.2.0\lib\dotless.Core.dll" KeyPath="yes" DiskId="1"/>
					</Component>

					<Component Id="LibComponent" Guid="59A868A8-BB89-4E0B-8D49-D9EE51EF3441">
						<File Id="LibDll" Name="SaltarelleLib.dll" Source="..\SaltarelleLib\SaltarelleLib.Server\bin\SaltarelleLib.dll" KeyPath="yes" DiskId="1" />
					</Component>
					<Component Id="ClientLibComponent" Guid="5443082E-95AE-483b-98AC-EC959A01EDCE">
						<File Id="ClientLibDll" Name="SaltarelleLib.Client.dll" Source="..\SaltarelleLib\SaltarelleLib.Client\bin\SaltarelleLib.Client.dll" KeyPath="yes" DiskId="1" />
					</Component>
					<Component Id="LibPdbComponent" Guid="4485951F-6FE7-4C4F-84EF-4899BC648236">
						<File Id="LibPdb" Name="SaltarelleLib.pdb" Source="..\SaltarelleLib\SaltarelleLib.Server\bin\SaltarelleLib.pdb" KeyPath="yes" DiskId="1" />
					</Component>
					<Component Id="LibXmlComponent" Guid="E3712727-4893-4783-8FAD-D03D90EC7D73">
						<File Id="LibXml" Name="SaltarelleLib.xml" Source="..\SaltarelleLib\SaltarelleLib.Server\bin\SaltarelleLib.xml" KeyPath="yes" DiskId="1" />
					</Component>
					<Component Id="ClientLibXmlComponent" Guid="2D7B57AF-E6BA-41CB-A14D-1C6952F8542D">
						<File Id="ClientLibXml" Name="SaltarelleLib.Client.xml" Source="..\SaltarelleLib\SaltarelleLib.Client\bin\SaltarelleLib.Client.xml" KeyPath="yes" DiskId="1" />
					</Component>

					<Component Id="ParserComponent" Guid="262446F3-5553-4161-9095-DC483070A5C0">
						<File Id="ParserDll" Name="SaltarelleParser.dll" Source="..\SaltarelleParser\SaltarelleParser.Server\bin\SaltarelleParser.dll" KeyPath="yes" DiskId="1"/>
					</Component>
					<Component Id="ClientParserComponent" Guid="56491C20-4426-4d79-9CCF-49D7F28FCD60">
						<File Id="ClientParserDll" Name="SaltarelleParser.Client.dll" Source="..\SaltarelleParser\SaltarelleParser.Client\bin\SaltarelleParser.Client.dll" KeyPath="yes" DiskId="1"/>
					</Component>
					<Component Id="ParserPdbComponent" Guid="BE62E768-7CB5-4054-9FEC-932631DDC918">
						<File Id="ParserPdb" Name="SaltarelleParser.pdb" Source="..\SaltarelleParser\SaltarelleParser.Server\bin\SaltarelleParser.pdb" KeyPath="yes" DiskId="1"/>
					</Component>
					<Component Id="ParserXmlComponent" Guid="542CCD0E-6BDF-4F5A-816B-2E0716A7233D">
						<File Id="ParserXml" Name="SaltarelleParser.xml" Source="..\SaltarelleParser\SaltarelleParser.Server\bin\SaltarelleParser.xml" KeyPath="yes" DiskId="1" />
					</Component>
					<Component Id="ClientParserXmlComponent" Guid="2769281E-4D81-4041-A2E6-B49A1984C4F7">
						<File Id="ClientParserXml" Name="SaltarelleParser.Client.xml" Source="..\SaltarelleParser\SaltarelleParser.Client\bin\SaltarelleParser.Client.xml" KeyPath="yes" DiskId="1" />
					</Component>

					<Component Id="UIComponent" Guid="B2F6E426-B482-4699-90A3-0DB21279F9EC">
						<File Id="UIDll" Name="Saltarelle.UI.dll" Source="..\Saltarelle.UI\Saltarelle.UI.Server\bin\Saltarelle.UI.dll" KeyPath="yes" DiskId="1"/>
					</Component>
					<Component Id="ClientUIComponent" Guid="654F3AF2-994E-4B69-BF9D-06EE0D22FDEE">
						<File Id="ClientUIDll" Name="Saltarelle.UI.Client.dll" Source="..\Saltarelle.UI\Saltarelle.UI.Client\bin\Saltarelle.UI.Client.dll" KeyPath="yes" DiskId="1"/>
					</Component>
					<Component Id="UIPdbComponent" Guid="8D5D2122-F969-4893-88EB-A2219B0B1D0F">
						<File Id="UIPdb" Name="Saltarelle.UI.pdb" Source="..\Saltarelle.UI\Saltarelle.UI.Server\bin\Saltarelle.UI.pdb" KeyPath="yes" DiskId="1"/>
					</Component>
					<Component Id="UIXmlComponent" Guid="4ACFDB25-3CD2-474E-9BD5-6FD901C68E33">
						<File Id="UIXml" Name="Saltarelle.UI.xml" Source="..\Saltarelle.UI\Saltarelle.UI.Server\bin\Saltarelle.UI.xml" KeyPath="yes" DiskId="1"/>
					</Component>
					<Component Id="ClientUIXmlComponent" Guid="A4C44D9E-4C37-425D-AF81-4E931D9DF703">
						<File Id="ClientUIXml" Name="Saltarelle.UI.Client.xml" Source="..\Saltarelle.UI\Saltarelle.UI.Client\bin\Saltarelle.UI.Client.xml" KeyPath="yes" DiskId="1"/>
					</Component>

					<Component Id="VSCustomToolComponent" Guid="2ECB28DC-0679-4E23-B3B1-F16E22656232">
						<File Id="VsCustomToolDll" Name="Saltarelle.VSCustomTool.dll" Source="..\Executables\VSCustomTool\bin\Saltarelle.VSCustomTool.dll" KeyPath="yes" DiskId="1"/>
					</Component>

					<Component Id="SalgenTaskComponent" Guid="B8E2A408-9171-47AE-A735-92C8B8573987">
						<File Id="SalgenTaskDll" Name="Saltarelle.SalgenTask.dll" Source="..\Executables\SalgenTask\bin\Saltarelle.SalgenTask.dll" KeyPath="yes" DiskId="1" />
					</Component>
					<Component Id="SaltarelleTargetsComponent" Guid="006E9107-F3AF-4D0D-80F0-53BF066DE0C3">
						<File Id="SaltarelleTargets" Name="Saltarelle.targets" Source="..\Executables\SalgenTask\Saltarelle.targets" KeyPath="yes" DiskId="1" />
					</Component> 

					<Component Id="SalgenExeComponent" Guid="BB39365F-8B0C-49D9-825E-DA7BDA2436D3">
						<File Id="SalgenExe" Name="salgen.exe" Source="..\Executables\Salgen.exe\bin\salgen.exe" KeyPath="yes" DiskId="1"/>
					</Component>
					
					<Component Id="VSCustomToolRegistryEntries" Guid="8A93DA05-85CA-467A-B031-5E1103FB504D">
						<RegistryKey Root="HKLM" Key="Software\Microsoft\VisualStudio\9.0\Generators\{FAE04EC1-301F-11D3-BF4B-00C04F79EFBC}\Salgen">
							<RegistryValue Type="string" Value="Saltarelle code generator that transforms a .tpl file to code." KeyPath="yes"/>
							<RegistryValue Name="CLSID" Type="string" Value="{D5BAD3F4-6C57-4901-AEEC-AE18BAB760D9}"/>
							<RegistryValue Name="GeneratesDesignTimeSource" Type="integer" Value="1"/>
						</RegistryKey>
					</Component>
				</Directory>
			</Directory>
		</Directory>

		<Feature Id="MainFeature" Title="Saltarelle" Level="1">
			<Feature Id="SaltarelleCore" Title="Core Components" Level="1">
				<ComponentRef Id="NewtonsoftJsonComponent"/>
				<ComponentRef Id="NewtonsoftJsonComponentGAC"/>
				
				<ComponentRef Id="MonoCecilComponent"/>
				<ComponentRef Id="MonoCecilComponentGAC"/>

				<ComponentRef Id="DotLessCssComponent"/>
				<ComponentRef Id="DotLessCssComponentGAC"/>
			
				<ComponentRef Id="LibComponent"/>
				<ComponentRef Id="LibComponentGAC"/>
				<ComponentRef Id="ClientLibComponent"/>
				<ComponentRef Id="LibPdbComponent"/>
				<ComponentRef Id="LibXmlComponent"/>
				<ComponentRef Id="ClientLibXmlComponent"/>
				<ComponentRef Id="ParserComponent"/>
				<ComponentRef Id="ParserComponentGAC"/>
				<ComponentRef Id="ClientParserComponent"/>
				<ComponentRef Id="ParserPdbComponent"/>
				<ComponentRef Id="ParserXmlComponent"/>
				<ComponentRef Id="ClientParserXmlComponent"/>
				<ComponentRef Id="UIComponent"/>
				<ComponentRef Id="ClientUIComponent"/>
				<ComponentRef Id="UIPdbComponent"/>
				<ComponentRef Id="UIXmlComponent"/>
				<ComponentRef Id="ClientUIXmlComponent"/>
				<ComponentRef Id="VSCustomToolComponent"/>
				<ComponentRef Id="VSCustomToolComponentGAC"/>
				<ComponentRef Id="SalgenTaskComponent"/>
				<ComponentRef Id="SalgenTaskComponentGAC"/>
				<ComponentRef Id="SaltarelleTargetsComponent"/>
				<ComponentRef Id="SalgenExeComponent"/>
				<ComponentRef Id="VSCustomToolRegistryEntries"/>
			</Feature>
			<Feature Id="SaltarelleSample" Title="Sample Web Site" Level="1">
			</Feature>
		</Feature>
		
<!--		<UIRef Id="WixUI_Mondo"/>-->
		
		<Upgrade Id="CB97D31F-A24E-4DCB-A2EF-803E60EDAAD5">
			<UpgradeVersion OnlyDetect="yes" Property="SELFFOUND" Minimum="0.5.0" IncludeMinimum="yes" Maximum="$(var.ProductVersion)" IncludeMaximum="yes"/>
			<UpgradeVersion OnlyDetect="yes" Property="NEWERFOUND" Minimum="$(var.ProductVersion)" IncludeMinimum="no" />
		</Upgrade>

		<CustomAction Id='AlreadyUpdated' Error='Saltarelle $(var.ProductVersion) is alreaday installed.' />
		<CustomAction Id='NoDowngrade' Error='A later version of [ProductName] is already installed.' />

		<InstallExecuteSequence>
			<Custom Action='AlreadyUpdated' After='FindRelatedProducts'>SELFFOUND</Custom>
			<Custom Action='NoDowngrade' After='FindRelatedProducts'>NEWERFOUND</Custom>
		</InstallExecuteSequence>
	</Product>
</Wix>
